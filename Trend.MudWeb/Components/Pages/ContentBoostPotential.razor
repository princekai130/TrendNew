@page "/ContentBoostPotential"
@using Microsoft.AspNetCore.Components.Authorization
@using Trend.MudWeb.Models
@inject TrendRepo Repo
@inject AuthenticationStateProvider AuthProvider

<PageTitle>Content Boost Potential</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-6">
    <MudStack Direction="Row" Spacing="2" Class="mb-4" AlignItems="AlignItems.Center">
        <MudIcon Icon="@Icons.Material.Filled.RocketLaunch" Color="Color.Primary" Size="Size.Large" />
        <MudText Typo="Typo.h3">Content Boost Potential</MudText>
    </MudStack>

    <MudText Typo="Typo.body1" Class="mb-8">
        Sistem cerdas kami menganalisis postingan lama Anda dan membandingkannya dengan tren saat ini untuk menemukan konten yang layak di-boost ulang. [cite: 3, 7]
    </MudText>

    <AuthorizeView Policy="PremiumOnly" Context="premiumContext">
        <Authorized>
            <MudGrid>
                @if (_boostRecommendations == null)
                {
                    <MudItem xs="12" Class="d-flex justify-center">
                        <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
                    </MudItem>
                }
                else
                {
                    <MudItem xs="12">
                        <MudTable Items="@_boostRecommendations" Hover="true" Breakpoint="Breakpoint.Sm" Elevation="3">
                            <HeaderContent>
                                <MudTh>Konten / Postingan</MudTh>
                                <MudTh>Engagement Asli</MudTh>
                                <MudTh>Re-Boost Score</MudTh>
                                <MudTh>Aksi</MudTh>
                            </HeaderContent>
                            <RowTemplate Context="item">
                                <MudTd DataLabel="Konten">
                                    <MudStack Row="true" AlignItems="AlignItems.Center">
                                        <MudAvatar Color="Color.Secondary" Variant="Variant.Outlined" Size="Size.Small">
                                            <MudIcon Icon="@(item.Platform == "TikTok" ? Icons.Custom.Brands.TikTok : Icons.Custom.Brands.Instagram)" />
                                        </MudAvatar>
                                        <MudText Typo="Typo.body2">@item.PostTitle</MudText>
                                    </MudStack>
                                </MudTd>
                                <MudTd DataLabel="Engagement">@item.OriginalEngagement.ToString("N0")</MudTd>
                                <MudTd DataLabel="Score">
                                    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                                        <MudProgressLinear Color="@GetColorByScore(item.BoostScore)" Value="@item.BoostScore" Class="my-7" />
                                        <MudText Typo="Typo.caption">@item.BoostScore%</MudText>
                                    </MudStack>
                                </MudTd>
                                <MudTd>
                                    <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Small">Boost Now</MudButton>
                                </MudTd>
                            </RowTemplate>
                        </MudTable>
                    </MudItem>
                }
            </MudGrid>
        </Authorized>
        <NotAuthorized>
            @* Upselling untuk 77,8% responden yang bersedia membayar jika bermanfaat [cite: 31, 52] *@
            <MudAlert Severity="Severity.Warning" Variant="Variant.Filled" Icon="@Icons.Material.Filled.Lock" Class="mt-4">
                Fitur Content Boost adalah fitur eksklusif Premium.
                92% kreator menggunakan fitur ini untuk memaksimalkan ROI konten lama mereka.
            </MudAlert>
            <div class="d-flex justify-center mt-6">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Large">Upgrade ke Premium</MudButton>
            </div>
        </NotAuthorized>
    </AuthorizeView>
</MudContainer>

@code {
    private List<BoostItem> _boostRecommendations;

    protected override async Task OnInitializedAsync()
    {
        // Simulasi delay pengambilan data dari sistem scraping + ML
        await Task.Delay(1000);

        _boostRecommendations = new List<BoostItem>
    {
        new BoostItem { PostTitle = "Tutorial Hijab Kondangan", Platform = "Instagram", OriginalEngagement = 12500, BoostScore = 95 },
        // Perbaikan: Mengganti 'Boost' menjadi 'BoostItem'
        new BoostItem { PostTitle = "Review Gadget Murah 2024", Platform = "TikTok", OriginalEngagement = 45000, BoostScore = 88 },
        new BoostItem { PostTitle = "Tips Diet Pemula", Platform = "TikTok", OriginalEngagement = 8200, BoostScore = 72 }
    };
    }

    private Color GetColorByScore(int score) => score switch
    {
        >= 90 => Color.Success,
        >= 75 => Color.Info,
        _ => Color.Warning
    };

    public class BoostItem
    {
        public string PostTitle { get; set; }
        public string Platform { get; set; }
        public int OriginalEngagement { get; set; }
        public int BoostScore { get; set; }
    }
}