@page "/TheHotList"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Policy = "PremiumOnly")]

<style>
    @@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;800&display=swap');

    .hotlist-container {
        font-family: 'Outfit', sans-serif;
    }

    .recipe-card {
        background: var(--mud-palette-surface);
        border: 1px solid var(--mud-palette-divider);
        border-radius: 24px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

        .recipe-card:hover {
            transform: translateY(-8px);
            border-color: var(--mud-palette-primary);
            box-shadow: 0 20px 30px -10px rgba(0,0,0,0.1);
        }

    .ai-magic-btn {
        background: linear-gradient(90deg, #594AE2 0%, #FF4081 100%) !important;
        color: white !important;
        font-weight: 700 !important;
        border-radius: 12px !important;
        text-transform: none !important;
    }

    .viral-badge {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 64, 129, 0.1);
        color: #FF4081;
        padding: 4px 12px;
        border-radius: 8px;
        font-size: 0.7rem;
        font-weight: 800;
    }
</style>

<MudContainer MaxWidth="MaxWidth.Large" Class="hotlist-container mt-10">
    <MudStack Direction="Row" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween" Class="mb-10">
        <MudStack Spacing="0">
            <MudText Typo="Typo.h3" Class="fw-bold" Style="letter-spacing: -2px;">The Hot List 🔥</MudText>
            <MudText Typo="Typo.body1" Color="Color.Secondary">Resep konten siap saji berdasarkan tren dengan momentum tertinggi.</MudText>
        </MudStack>
        <MudChip T="string" Color="Color.Warning" Variant="Variant.Filled" Icon="@Icons.Material.Filled.AutoAwesome">Premium Access</MudChip>
    </MudStack>

    <MudGrid>
        @foreach (var trend in _hotTrends)
        {
            <MudItem xs="12" md="6" lg="4">
                <MudPaper Class="pa-6 recipe-card shadow-none">
                    <div class="viral-badge">HIGH POTENTIAL</div>

                    <MudStack Spacing="4">
                        <div class="d-flex align-center">
                            <MudIcon Icon="@Icons.Custom.Brands.TikTok" Size="Size.Small" Class="mr-2" />
                            <MudText Typo="Typo.caption" Color="Color.Secondary">TIKTOK TREND</MudText>
                        </div>

                        <MudText Typo="Typo.h5" Class="fw-bold">@trend.Name</MudText>

                        <div class="d-flex gap-2">
                            <MudChip T="string" Size="Size.Small" Variant="Variant.Text" Icon="@Icons.Material.Filled.Speed" Color="Color.Info">Mudah</MudChip>
                            <MudChip T="string" Size="Size.Small" Variant="Variant.Text" Icon="@Icons.Material.Filled.BarChart" Color="Color.Primary">Low Comp</MudChip>
                        </div>

                        <MudDivider Style="opacity: 0.1;" />

                        <div class="d-flex align-center justify-space-between">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">AI Content Idea</MudText>
                            <MudIconButton Icon="@Icons.Material.Rounded.AutoAwesome"
                                           Class="ai-magic-btn"
                                           Size="Size.Small"
                                           OnClick="@(() => GenerateAIIdeas(trend.Name))" />
                        </div>

                        @if (_isGenerating && _selectedTrend == trend.Name)
                        {
                            <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="rounded-pill" />
                        }
                        else if (!string.IsNullOrEmpty(trend.GeneratedIdea) && _selectedTrend == trend.Name)
                        {
                            <MudAlert Severity="Severity.Info" Variant="Variant.Outlined" Class="mt-2" Style="border-radius: 12px; font-size: 0.85rem;">
                                <b>Hook:</b> @trend.GeneratedIdea
                            </MudAlert>
                        }
                    </MudStack>
                </MudPaper>
            </MudItem>
        }
    </MudGrid>
</MudContainer>

@code {
    private bool _isGenerating = false;
    private string _selectedTrend = "";

    private List<HotTrendItem> _hotTrends = new()
    {
        new HotTrendItem { Name = "AI Avatar Dance", Platform = "TikTok" },
        new HotTrendItem { Name = "POV: Working in Tech", Platform = "Instagram" },
        new HotTrendItem { Name = "Minimalist Desk Setup", Platform = "TikTok" }
    };

    private async Task GenerateAIIdeas(string trendName)
    {
        _selectedTrend = trendName;
        _isGenerating = true;
        StateHasChanged();

        // SIMULASI PANGGIL AI (Nanti di sini panggil OpenAI API)
        await Task.Delay(2000);

        var trend = _hotTrends.First(t => t.Name == trendName);
        trend.GeneratedIdea = "Tunjukkan transisi cepat antara layar coding yang berantakan ke hasil desain yang estetik dengan sound 'Magic'!";

        _isGenerating = false;
        StateHasChanged();
    }

    public class HotTrendItem
    {
        public string Name { get; set; }
        public string Platform { get; set; }
        public string GeneratedIdea { get; set; }
    }
}